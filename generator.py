import os, re, random
template_dir = "./templates/"
files: list[str] = os.listdir(template_dir)
temp_first: str = ""
temp_last: str = ""
with open(template_dir + "template.html", 'r') as file:
    toggle: bool = True
    for line in file:
        if toggle:
            temp_first += line
            if "stylesheet" in line:
                temp_first += '<link rel="stylesheet" href="style.css?v=' + str(random.randint(0, 99999)) + '">'
                # prevent stylesheet from getting cached
        else:
            temp_last += line
        if "main-content" in line:
            toggle = False
def find_text_between_delimiters(text: str) -> list[str]:
    # This regex will find all occurrences of text between ::
    pattern = r'::(.*?)::'
    matches = re.findall(pattern, text)
    return matches
def process_template(filename: str):
    html_string: str = "<!-- GENERATED BY generator.py -->"
    html_string += temp_first
    with open(template_dir + filename, 'r') as file:
        for line in file:
            html_string += line
            if "file::" in line and "code-head" in line: 
                # insert files between file::<filename>:: if its specified in a div called codehead
                html_string += "<pre><code>"
                path: str = find_text_between_delimiters(line)[0]
                with open(path, 'r') as file2:
                    for l in file2:
                        html_string += l.replace("<", "&lt;").replace(">", "&gt;") 
                        # replace <,> to be able to see html tags in literal files
                html_string += "</code></pre>"
    html_string += temp_last

    with open(filename[:-4] + "html", 'w') as file:
        file.write(html_string)
for file_ in files:
    if ".temp" in file_:
        process_template(file_)